---
phase: 26-documentation-polish
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - README.md
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "User can copy-paste docker run command and get working CocoSearch container"
    - "User can configure Claude Code with stdio transport for Docker-based CocoSearch"
    - "User can configure Claude Desktop with HTTP transport via mcp-remote proxy"
    - "User can persist index data across container restarts using documented volume mounts"
    - "User can diagnose container startup issues using documented troubleshooting steps"
  artifacts:
    - path: "README.md"
      provides: "Docker quick start and troubleshooting documentation"
      contains: "## Docker Quick Start"
    - path: ".gitignore"
      provides: "Exclusion for repo-local volume storage"
      contains: ".cocosearch-data/"
  key_links:
    - from: "README.md Docker Quick Start"
      to: "docker/Dockerfile"
      via: "docker run command references image built from Dockerfile"
      pattern: "docker run.*cocosearch"
    - from: "README.md Claude Desktop section"
      to: "mcp-remote npm package"
      via: "npx mcp-remote command bridges HTTP to stdio"
      pattern: "npx.*mcp-remote"
---

<objective>
Add Docker deployment documentation and troubleshooting guide to README.md

Purpose: Enable users to deploy CocoSearch via Docker and connect it to Claude Code or Claude Desktop with minimal friction. Complete the v1.6 milestone documentation requirements.

Output: Updated README.md with Docker Quick Start sections, MCP client configuration for Docker, volume persistence guide, and component-based troubleshooting. Updated .gitignore for repo-local data directory.
</objective>

<execution_context>
@/Users/fedorzhdanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fedorzhdanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/26-documentation-polish/26-CONTEXT.md
@.planning/phases/26-documentation-polish/26-RESEARCH.md
@.planning/phases/24-container-foundation/24-04-SUMMARY.md

# Source files for accurate documentation
@README.md
@docker/Dockerfile
@.gitignore
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Docker Quick Start documentation to README.md</name>
  <files>README.md</files>
  <action>
Add a new "Docker Quick Start" section to README.md after the existing "Installing" section but before "Getting Started". Structure:

## Docker Quick Start (All-in-One)

Brief intro: Single container bundles PostgreSQL, Ollama, and MCP server. No separate setup needed.

### Quick Start for Claude Code (stdio)

Show the `claude mcp add` command that runs container with stdio transport:
```bash
claude mcp add --transport stdio --scope user cocosearch -- \
  docker run -i --rm \
  -v cocosearch-data:/data \
  -v "$PWD":/mnt/repos:ro \
  cocosearch cocosearch mcp --transport stdio
```

Also show JSON config alternative for `~/.claude.json`:
```json
{
  "mcpServers": {
    "cocosearch": {
      "command": "docker",
      "args": ["run", "-i", "--rm", "-v", "cocosearch-data:/data", "-v", "/absolute/path/to/repos:/mnt/repos:ro", "cocosearch", "cocosearch", "mcp", "--transport", "stdio"]
    }
  }
}
```

Note: Explain `-i` flag for interactive (stdin attached), `--rm` for cleanup.

### Quick Start for Claude Desktop (HTTP via mcp-remote)

Two-step process:
1. Start container as daemon:
```bash
docker run -d --name cocosearch \
  -v cocosearch-data:/data \
  -v "$PWD":/mnt/repos:ro \
  -p 3000:3000 \
  cocosearch
```

2. Add to claude_desktop_config.json (show macOS/Linux/Windows paths):
```json
{
  "mcpServers": {
    "cocosearch": {
      "command": "npx",
      "args": ["mcp-remote", "http://localhost:3000/mcp"]
    }
  }
}
```

CRITICAL: Add note explaining why mcp-remote is needed - Claude Desktop cannot directly connect to HTTP/SSE servers, requires stdio bridge.

### Data Persistence

Explain named volume `cocosearch-data:/data` persists:
- PostgreSQL database (`/data/pg_data`)
- Ollama models (`/data/ollama_models`)
- CocoSearch metadata (`/data/cocosearch`)

Show alternative with repo-local storage using `.cocosearch-data/`:
```bash
docker run -d \
  -v "$(pwd)/.cocosearch-data":/data \
  -v "$PWD":/mnt/repos:ro \
  -p 3000:3000 \
  cocosearch
```
Note: Add `.cocosearch-data/` to project's .gitignore.

### Building the Image

```bash
# Build from repository root
docker build -t cocosearch -f docker/Dockerfile .
```

Update Table of Contents to include new sections.
  </action>
  <verify>
1. README.md contains "## Docker Quick Start" section
2. Section includes both Claude Code and Claude Desktop examples
3. Volume mount documentation explains persistence
4. grep for "mcp-remote" confirms Claude Desktop workaround is documented
  </verify>
  <done>
Docker quick start guide exists with copy-paste examples for both Claude Code (stdio) and Claude Desktop (HTTP via mcp-remote). Volume persistence documented.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Troubleshooting Docker section to README.md</name>
  <files>README.md</files>
  <action>
Add "## Troubleshooting Docker" section after the Docker Quick Start section. Organize by component:

## Troubleshooting Docker

Brief intro: First diagnostic step is always `docker logs cocosearch`.

### Container Startup Issues

Common issues:
- **Container exits immediately**: Check `docker logs cocosearch` for errors. Common cause: port 3000 already in use (use `-p 3001:3000` instead)
- **Health check failing**: Container takes ~90s to fully start (model loading). Wait and check `docker inspect cocosearch --format='{{.State.Health.Status}}'`

### PostgreSQL Issues

- **"Connection refused" from MCP**: PostgreSQL may still be starting. Check logs for "database system is ready to accept connections"
- **Data corruption after unclean shutdown**: Always use `docker stop` (not `docker kill`). Container uses SIGTERM for graceful PostgreSQL shutdown.

### Ollama Issues

- **"Model not found" errors**: Model is pre-baked in image. If seeing this error, image may be corrupted - rebuild with `docker build --no-cache`
- **Slow first embedding**: First request warms up the model (~5-10s). Subsequent requests are fast.

### MCP Connection Issues

- **Claude Code "server disconnected"**: Ensure container is running with `-i` flag for stdio transport
- **Claude Desktop "connection refused"**:
  1. Verify container is running: `docker ps`
  2. Verify port mapping: should show `0.0.0.0:3000->3000/tcp`
  3. Verify mcp-remote is installed: `npx mcp-remote --version`
- **"Unknown transport" error**: Wrong transport for client. Claude Code uses stdio, Claude Desktop uses HTTP.

### Useful Commands

```bash
# Check container status
docker ps -a | grep cocosearch

# View logs (first diagnostic step)
docker logs cocosearch

# Follow logs in real-time
docker logs -f cocosearch

# Check health status
docker inspect cocosearch --format='{{.State.Health.Status}}'

# Interactive debug shell
docker exec -it cocosearch sh

# Restart container
docker restart cocosearch
```

Update Table of Contents.
  </action>
  <verify>
1. README.md contains "## Troubleshooting Docker" section
2. Section organized by component (PostgreSQL, Ollama, MCP)
3. `docker logs` mentioned as first diagnostic step
4. Port conflict solution documented
  </verify>
  <done>
Troubleshooting guide exists covering container startup, PostgreSQL, Ollama, and MCP connection issues with component-based organization.
  </done>
</task>

<task type="auto">
  <name>Task 3: Update .gitignore for repo-local Docker data</name>
  <files>.gitignore</files>
  <action>
Add `.cocosearch-data/` to .gitignore to support repo-local volume storage pattern documented in Docker Quick Start.

Add at end of file with comment:
```
# Docker data directory (repo-local volume storage)
.cocosearch-data/
```
  </action>
  <verify>
1. .gitignore contains `.cocosearch-data/`
2. git status shows .gitignore as modified
  </verify>
  <done>
.gitignore updated to exclude repo-local Docker data directory.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Docker Quick Start completeness:**
   - grep README.md for "## Docker Quick Start" - section exists
   - grep README.md for "claude mcp add" - Claude Code CLI example exists
   - grep README.md for "mcp-remote" - Claude Desktop workaround documented
   - grep README.md for "cocosearch-data:/data" - Volume persistence documented

2. **Troubleshooting completeness:**
   - grep README.md for "## Troubleshooting Docker" - section exists
   - grep README.md for "PostgreSQL Issues" - component section exists
   - grep README.md for "docker logs" - first diagnostic step documented

3. **gitignore update:**
   - grep .gitignore for ".cocosearch-data" - directory excluded

4. **Table of Contents:**
   - README.md ToC includes Docker sections
</verification>

<success_criteria>
Phase 26 success criteria satisfied:
1. Docker quick start guide exists with copy-paste `docker run` examples - YES
2. Claude Code configuration example exists showing stdio transport setup - YES (CLI and JSON)
3. Claude Desktop configuration example exists showing SSE/HTTP transport setup - YES (via mcp-remote)
4. Volume mount and data persistence documentation covers common scenarios - YES (named volume + repo-local)
5. Troubleshooting guide covers container startup failures and connectivity issues - YES (component-based)
</success_criteria>

<output>
After completion, create `.planning/phases/26-documentation-polish/26-01-SUMMARY.md`
</output>
