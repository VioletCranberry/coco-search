---
phase: 01-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - docker-compose.yml
  - .env
  - .env.example
  - pyproject.toml
  - src/cocosearch/__init__.py
  - .gitignore
autonomous: true

must_haves:
  truths:
    - "PostgreSQL container starts and accepts connections"
    - "Ollama has nomic-embed-text model available"
    - "Python project initializes with UV and dependencies install"
  artifacts:
    - path: "docker-compose.yml"
      provides: "PostgreSQL + pgvector orchestration"
      contains: "pgvector/pgvector:pg17"
    - path: ".env"
      provides: "Database connection configuration"
      contains: "COCOINDEX_DATABASE_URL"
    - path: "pyproject.toml"
      provides: "Python project configuration"
      contains: "cocoindex"
    - path: "src/cocosearch/__init__.py"
      provides: "Package entry point"
      min_lines: 1
  key_links:
    - from: ".env"
      to: "docker-compose.yml"
      via: "matching credentials"
      pattern: "cocoindex.*cocoindex"
---

<objective>
Set up development infrastructure: PostgreSQL with pgvector via Docker Compose, ensure Ollama has nomic-embed-text model, and initialize Python project with UV.

Purpose: Establish the foundational infrastructure that all subsequent phases depend on.
Output: Running PostgreSQL container, available embedding model, initialized Python project with dependencies.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Docker Compose and Environment Configuration</name>
  <files>
    - docker-compose.yml
    - .env
    - .env.example
    - .gitignore
  </files>
  <action>
Create Docker Compose configuration for PostgreSQL with pgvector:

1. Create `docker-compose.yml` with:
   - Service: `db` using `pgvector/pgvector:pg17` image
   - Container name: `cocosearch-db`
   - Port mapping: `5432:5432`
   - Environment: POSTGRES_USER=cocoindex, POSTGRES_PASSWORD=cocoindex, POSTGRES_DB=cocoindex
   - Volume: `postgres_data:/var/lib/postgresql/data`
   - Health check using `pg_isready -U cocoindex -d cocoindex`
   - restart: unless-stopped

2. Create `.env` with:
   - `COCOINDEX_DATABASE_URL=postgresql://cocoindex:cocoindex@localhost:5432/cocoindex`

3. Create `.env.example` as template (same content but with comments explaining each variable)

4. Create or update `.gitignore` with:
   - `.env` (but NOT `.env.example`)
   - `__pycache__/`
   - `*.pyc`
   - `.venv/`
   - `*.egg-info/`

5. Start the PostgreSQL container:
   ```bash
   docker compose up -d
   ```

6. Wait for container to be healthy:
   ```bash
   docker compose ps  # Should show "healthy"
   ```

Reference: RESEARCH.md Pattern 1 (Docker Compose with Health Checks) and Pattern 2 (Environment Configuration)
  </action>
  <verify>
Run: `docker compose ps` - container should show "healthy" status
Run: `docker exec cocosearch-db pg_isready -U cocoindex -d cocoindex` - should return "accepting connections"
  </verify>
  <done>PostgreSQL container running with healthy status, environment files created, .gitignore configured</done>
</task>

<task type="auto">
  <name>Task 2: Ollama Model Setup</name>
  <files>None (external service configuration)</files>
  <action>
Ensure Ollama has the nomic-embed-text model available:

1. Check if Ollama is running:
   ```bash
   curl -s http://localhost:11434/api/tags
   ```
   If connection refused, remind user to start Ollama (it's a native install per RESEARCH.md)

2. Check if nomic-embed-text is already pulled:
   ```bash
   curl -s http://localhost:11434/api/tags | grep -q "nomic-embed-text"
   ```

3. If model not present, pull it:
   ```bash
   ollama pull nomic-embed-text
   ```
   This downloads ~274MB on first run.

4. Verify model is available after pull:
   ```bash
   curl -s http://localhost:11434/api/tags | python3 -c "import sys,json; models=[m['name'] for m in json.load(sys.stdin).get('models',[])]; print('nomic-embed-text' if any('nomic-embed-text' in m for m in models) else 'NOT FOUND')"
   ```

Note: Ollama is installed natively (not via Docker) per RESEARCH.md recommendation for Phase 1 simplicity.
  </action>
  <verify>
Run: `curl -s http://localhost:11434/api/tags | grep nomic-embed-text` - should show model entry
  </verify>
  <done>Ollama running with nomic-embed-text model available</done>
</task>

<task type="auto">
  <name>Task 3: Python Project Initialization</name>
  <files>
    - pyproject.toml
    - uv.lock
    - .python-version
    - src/cocosearch/__init__.py
  </files>
  <action>
Initialize Python project with UV and install dependencies:

1. Initialize UV project with src layout:
   ```bash
   uv init --package --python 3.11
   ```
   Note: Run from project root. This creates pyproject.toml, src/cocosearch/, etc.

2. Add core dependencies:
   ```bash
   uv add "cocoindex[embeddings]"
   uv add "mcp[cli]"
   uv add "psycopg[binary,pool]"
   uv add pgvector
   ```

3. Add development dependencies:
   ```bash
   uv add --dev pytest ruff
   ```

4. Verify lock file was created:
   ```bash
   ls -la uv.lock
   ```

5. Update `src/cocosearch/__init__.py` to export version:
   ```python
   """CocoSearch: Local-first semantic code search."""

   __version__ = "0.1.0"
   ```

6. Verify dependencies install correctly:
   ```bash
   uv sync
   ```

Reference: RESEARCH.md Pattern 5 (UV Project Initialization) and Standard Stack section
  </action>
  <verify>
Run: `uv run python -c "import cocoindex; print(cocoindex.__version__)"` - should print cocoindex version
Run: `uv run python -c "import psycopg; import pgvector; print('OK')"` - should print "OK"
  </verify>
  <done>Python project initialized with UV, all dependencies installed, uv.lock committed</done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Docker verification:
   - `docker compose ps` shows cocosearch-db as healthy
   - `docker exec cocosearch-db psql -U cocoindex -d cocoindex -c "SELECT 1"` returns 1

2. Ollama verification:
   - `curl -s http://localhost:11434/api/tags` shows nomic-embed-text in models list

3. Python verification:
   - `uv run python -c "import cocoindex, psycopg, pgvector; print('All imports OK')"` succeeds
</verification>

<success_criteria>
- PostgreSQL container running and healthy (docker compose ps shows healthy)
- Ollama has nomic-embed-text model available
- Python project has pyproject.toml with all dependencies
- uv.lock exists and is committed
- All Python imports work (cocoindex, psycopg, pgvector)
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-01-SUMMARY.md`
</output>
