---
phase: 19-config-env-var-substitution
plan: 2
total_plans: 2
status: not_started
last_updated: 2026-01-31T23:42:00Z
---

<current_state>
Phase 19 execution is 50% complete. Wave 1 (plan 19-01) finished successfully. Wave 2 (plan 19-02) was about to start when paused.

All code is committed. No uncommitted changes.
</current_state>

<completed_work>

## Plan 19-01: TDD Environment Variable Substitution - COMPLETE

Created pure function `substitute_env_vars()` with full test coverage:

- `src/cocosearch/config/env_substitution.py` - 74 lines
- `tests/unit/config/test_env_substitution.py` - 296 lines, 26 tests

Features implemented:
- `${VAR}` syntax for required environment variables
- `${VAR:-default}` syntax for optional vars with fallback
- Recursive processing of dicts and lists
- Returns tuple `(result, missing_vars)` for error handling
- Deduplicates missing vars while preserving order

Commits:
- `362d28e` test(19-01): add failing test for env var substitution
- `c721a82` feat(19-01): implement env var substitution
- `eb7dd2f` docs(19-01): complete env var substitution plan
</completed_work>

<remaining_work>

## Plan 19-02: Integration into Config Loader - NOT STARTED

3 tasks:

1. **Task 1: Integrate substitution into loader.py**
   - Import `substitute_env_vars` from `.env_substitution`
   - Call after `yaml.safe_load()`, before `model_validate()`
   - Raise `ConfigError` if `missing_vars` is not empty
   - Update docstring

2. **Task 2: Add loader integration tests**
   - Add `TestEnvVarSubstitution` class to `test_loader.py`
   - Tests for indexName, indexing section, embedding section substitution
   - Tests for error handling with missing vars

3. **Task 3: Verify full test suite passes**
   - Run `uv run pytest tests/unit/ -v`
   - Ensure no regressions

After 19-02 completes:
- Phase verification via `gsd-verifier`
- Update ROADMAP.md, STATE.md, REQUIREMENTS.md
- Offer next phase (Phase 20: Env Var Standardization)
</remaining_work>

<decisions_made>

- Hand-rolled regex substitution instead of library (no new dependencies)
- Return tuple `(result, missing_vars)` so caller controls error handling
- Post-parse substitution: process after YAML load, before Pydantic validation
</decisions_made>

<blockers>
None. Clean state ready to continue.
</blockers>

<context>
Phase 19 enables `${VAR}` and `${VAR:-default}` syntax in cocosearch.yaml config files. This is part of the v1.5 milestone focused on configuration polish.

The wave-based execution model:
- Wave 1 (19-01): Create the pure function - DONE
- Wave 2 (19-02): Integrate into loader.py - NEXT

The orchestrator was about to spawn a gsd-executor agent for plan 19-02 when paused.
</context>

<next_action>
Resume with: `/gsd:execute-phase 19`

This will:
1. Detect 19-01 is complete (has SUMMARY.md)
2. Detect 19-02 is incomplete (no SUMMARY.md)
3. Execute only 19-02
4. Run verification
5. Complete phase
</next_action>
