---
phase: 07-documentation
plan: 03
type: execute
wave: 3
depends_on: [07-02]
files_modified: [README.md]
autonomous: true

must_haves:
  truths:
    - "User can reference all CLI commands with flags and descriptions"
    - "User can see usage examples for each CLI command"
    - "User can see expected output for commands"
    - "User can configure indexing via .cocosearch.yaml"
    - "README links sections together coherently"
  artifacts:
    - path: "README.md"
      provides: "Complete CLI reference and configuration documentation"
      contains: ["## CLI Reference", "### Indexing", "### Searching", "### Managing", ".cocosearch.yaml"]
  key_links:
    - from: "README.md"
      to: "src/cocosearch/cli.py"
      via: "command documentation"
      pattern: "cocosearch (index|search|list|stats|clear)"
---

<objective>
Add CLI reference (organized by workflow) and configuration section to complete the README.

Purpose: Provide complete command reference so users can use all CocoSearch features.
Output: CLI Reference section with all commands, examples, and expected output. Configuration section for .cocosearch.yaml.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/07-documentation/07-CONTEXT.md
@.planning/phases/07-documentation/07-RESEARCH.md
@README.md
@src/cocosearch/cli.py
@src/cocosearch/indexer/config.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add CLI Reference - Indexing and Searching commands</name>
  <files>README.md</files>
  <action>
Add "## CLI Reference" section organized by workflow (per CONTEXT.md).

**Intro**: "CocoSearch provides a command-line interface for indexing and searching code. Output is JSON by default (for scripting/MCP); use `--pretty` for human-readable output."

**### Indexing**

`cocosearch index <path> [options]`

Index a codebase for semantic search.

| Flag | Description | Default |
|------|-------------|---------|
| `-n, --name` | Index name | Derived from directory |
| `-i, --include` | Include file patterns (repeatable) | See defaults below |
| `-e, --exclude` | Exclude file patterns (repeatable) | None |
| `--no-gitignore` | Ignore .gitignore patterns | Respects .gitignore |

**Example**:
```bash
cocosearch index ./my-project --name myproject
```

Output:
```
Using derived index name: myproject
Indexing ./my-project...
Indexed 42 files
```

**### Searching**

`cocosearch search <query> [options]`
`cocosearch search --interactive`

Search indexed code using natural language.

| Flag | Description | Default |
|------|-------------|---------|
| `-n, --index` | Index to search | Auto-detect from cwd |
| `-l, --limit` | Max results | 10 |
| `--lang` | Filter by language | None |
| `--min-score` | Minimum similarity (0-1) | 0.3 |
| `-c, --context` | Context lines | 5 |
| `-i, --interactive` | Enter REPL mode | Off |
| `--pretty` | Human-readable output | JSON |

**Examples**:
```bash
# Basic search
cocosearch search "authentication logic" --pretty

# Filter by language
cocosearch search "error handling" --lang python

# Inline language filter
cocosearch search "database connection lang:go"

# Interactive mode
cocosearch search --interactive
```

Output (--pretty):
```
[1] src/auth/login.py:45-67 (score: 0.89)
    def authenticate_user(username: str, password: str) -> User:
        """Authenticate user credentials against database."""
        ...
```
  </action>
  <verify>grep -A 50 "### Indexing" README.md && grep -A 60 "### Searching" README.md shows both command sections with tables and examples</verify>
  <done>CLI Reference has Indexing and Searching sections with flags, examples, and output</done>
</task>

<task type="auto">
  <name>Task 2: Add CLI Reference - Managing commands</name>
  <files>README.md</files>
  <action>
Add management commands section to CLI Reference.

**### Managing Indexes**

**List indexes**: `cocosearch list [--pretty]`

Show all available indexes.

```bash
cocosearch list --pretty
```

Output:
```
       Indexes
┏━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━┓
┃ Name       ┃ Table                  ┃
┡━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━┩
│ myproject  │ cocosearch_myproject   │
│ another    │ cocosearch_another     │
└────────────┴────────────────────────┘
```

**Index statistics**: `cocosearch stats [index] [--pretty]`

Show statistics for one or all indexes.

```bash
cocosearch stats myproject --pretty
```

Output:
```
    Index: myproject
┏━━━━━━━━━┳━━━━━━━━━━━┓
┃ Metric  ┃ Value     ┃
┡━━━━━━━━━╇━━━━━━━━━━━┩
│ Files   │ 42        │
│ Chunks  │ 127       │
│ Size    │ 2.3 MB    │
└─────────┴───────────┘
```

**Clear index**: `cocosearch clear <index> [--force] [--pretty]`

Delete an index and all its data. Prompts for confirmation unless `--force`.

```bash
cocosearch clear myproject --force
```

Output:
```
Index 'myproject' deleted successfully
```

**Start MCP server**: `cocosearch mcp`

Start the MCP server for LLM integration. Typically invoked by MCP clients, not directly.

```bash
cocosearch mcp  # Runs until killed, used by Claude/OpenCode
```
  </action>
  <verify>grep -A 40 "### Managing" README.md shows list, stats, clear, and mcp commands with examples</verify>
  <done>CLI Reference has Managing section with all management commands</done>
</task>

<task type="auto">
  <name>Task 3: Add Configuration section and finalize README</name>
  <files>README.md</files>
  <action>
Add "## Configuration" section and finalize the README.

**## Configuration**

**### .cocosearch.yaml**

Create `.cocosearch.yaml` in your project root to customize indexing:

```yaml
indexing:
  include_patterns:
    - "*.py"
    - "*.js"
    - "*.ts"
    - "*.go"
    - "*.rs"
  exclude_patterns:
    - "*_test.go"
    - "*.min.js"
  chunk_size: 1000      # bytes
  chunk_overlap: 300    # bytes
```

Default include patterns (when no config):
`*.py`, `*.js`, `*.ts`, `*.tsx`, `*.jsx`, `*.rs`, `*.go`, `*.java`, `*.c`, `*.cpp`, `*.h`, `*.hpp`, `*.rb`, `*.php`, `*.swift`, `*.kt`, `*.scala`, `*.md`, `*.mdx`

**### Environment Variables**

| Variable | Description | Default |
|----------|-------------|---------|
| `COCOINDEX_DATABASE_URL` | PostgreSQL connection URL | `postgresql://cocoindex:cocoindex@localhost:5432/cocoindex` |
| `OLLAMA_HOST` | Ollama API host | `http://localhost:11434` |

**Final cleanup**:
1. Review all sections for consistency
2. Ensure all placeholder text ("See below") is replaced with actual content or removed
3. Add any missing cross-references between sections
4. Verify all code blocks have correct syntax highlighting (bash, json, yaml, python)
5. Ensure README flows logically: intro -> quick start -> installation -> MCP -> CLI -> config
  </action>
  <verify>grep -A 25 "## Configuration" README.md shows .cocosearch.yaml example and environment variables table</verify>
  <done>Configuration section complete and README finalized</done>
</task>

</tasks>

<verification>
- [ ] "## CLI Reference" section exists
- [ ] Indexing, Searching, Managing subsections present
- [ ] Each command has synopsis, flags table, example, and output
- [ ] "## Configuration" section exists
- [ ] .cocosearch.yaml example shown
- [ ] Environment variables table present
- [ ] No placeholder text remains
- [ ] All code blocks have syntax highlighting
- [ ] README flows logically from intro to reference
</verification>

<success_criteria>
User can:
1. Look up any CLI command with flags and examples
2. See expected output for each command
3. Create .cocosearch.yaml to customize indexing
4. Understand environment variables for configuration
5. Navigate README sections using table of contents
</success_criteria>

<output>
After completion, create `.planning/phases/07-documentation/07-03-SUMMARY.md`
</output>
