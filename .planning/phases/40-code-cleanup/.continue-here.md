---
phase: 40-code-cleanup
plan: 02
total_plans: 2
status: ready_to_start
last_updated: 2026-02-06
---

<current_state>
Phase 40 execution in progress. Plan 40-01 completed successfully. Plan 40-02 ready to execute (wave 2).

The orchestrator was running `/gsd:execute-phase 40` and had just completed Wave 1 (plan 40-01). Wave 2 (plan 40-02) has not started yet.
</current_state>

<completed_work>

## Wave 1 Complete

- **40-01: Remove deprecated languages.py and metadata.py modules** ✓
  - Deleted src/cocosearch/indexer/languages.py (26 lines)
  - Deleted src/cocosearch/indexer/metadata.py (111 lines)
  - Updated tests to import from cocosearch.handlers directly
  - Updated indexer __init__.py to export from handlers
  - Fixed unused import (extract_extension) in flow.py
  - LOC reduced by 137 lines (9,274 → 9,138)
  - Commits: db675cc, a6c90a0
  - SUMMARY.md created

</completed_work>

<remaining_work>

## Wave 2 (Not Started)

- **40-02: Remove v1.2 graceful degradation from search modules**
  - Remove pre-v1.2 metadata column fallback from query.py
  - Remove pre-v1.2 fallback from hybrid.py
  - Update stats.py and db.py comments (keep v1.7 graceful degradation)
  - Expected LOC reduction: ~100 lines

## Post-Execution Steps
- Verify phase goal (spawn gsd-verifier)
- Update ROADMAP.md and STATE.md
- Update REQUIREMENTS.md (mark CLEAN-01 through CLEAN-04 as Complete)
- Commit phase completion

</remaining_work>

<decisions_made>

- 40-01: Removed DevOpsMetadata from indexer __all__ exports (backward-compat wrapper no longer public API)
- 40-01: Tests that need DevOpsMetadata now define local dataclass rather than importing from deprecated module
- schema_migration.py is NOT deprecated - it's necessary for PostgreSQL-specific features (TSVECTOR, GIN indexes)

</decisions_made>

<blockers>
None
</blockers>

<context>
Running phase 40 (Code Cleanup) execution. This phase has 2 plans:
- Wave 1: 40-01 (deprecated module removal) - DONE
- Wave 2: 40-02 (v1.2 graceful degradation removal) - NOT STARTED

Wave 2 depends on Wave 1 because v1.2 graceful degradation code may have had imports from deprecated modules.

The executor for 40-01 ran successfully and created proper commits and summary. The STATE.md shows 40-01 complete but the orchestrator hadn't finished committing the 40-01 artifacts.
</context>

<next_action>
Resume with: `/gsd:execute-phase 40`

The command will detect 40-01 has SUMMARY.md (complete), skip to Wave 2, and execute 40-02.

Alternatively, if you want to verify 40-01 completion first:
```bash
cat .planning/phases/40-code-cleanup/40-01-SUMMARY.md
uv run pytest tests/unit/indexer/ -v  # verify tests pass
```
</next_action>
