---
phase: 41-workflow-skills
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - skills/coco-onboarding/SKILL.md
autonomous: true

must_haves:
  truths:
    - "Onboarding skill guides users through understanding a new codebase step-by-step"
    - "Skill starts with architecture overview (entry points, main modules, organization)"
    - "Skill drills into key architectural layers with code examples from the codebase"
    - "Skill offers to index the codebase if no CocoSearch index exists"
    - "Skill optionally generates a summary document with date/index-version freshness marker"
    - "Skill auto-executes CocoSearch searches at each step without manual triggering"
    - "Skill uses adaptive branching based on what was found (not rigid linear)"
  artifacts:
    - path: "skills/coco-onboarding/SKILL.md"
      provides: "Onboarding workflow skill for Claude Code"
      min_lines: 100
      contains: "search_code"
  key_links:
    - from: "skills/coco-onboarding/SKILL.md"
      to: "CocoSearch MCP tools"
      via: "search_code, list_indexes, index_stats, index_codebase tool references"
      pattern: "search_code|list_indexes|index_stats|index_codebase"
---

<objective>
Create the onboarding workflow skill that guides users through understanding a new codebase step-by-step using CocoSearch.

Purpose: Give users a "senior developer walkthrough" experience when joining a new project -- architecture overview, key layers, code examples, all powered by semantic search.
Output: SKILL.md file in skills/coco-onboarding/ directory
</objective>

<execution_context>
@/Users/fedorzhdanov/.claude/get-shit-done/workflows/execute-plan.md
@/Users/fedorzhdanov/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/41-workflow-skills/41-CONTEXT.md
@.planning/phases/41-workflow-skills/41-RESEARCH.md
@.claude/skills/cocosearch/SKILL.md (existing skill for format reference)
@src/cocosearch/mcp/server.py (MCP tool signatures)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create onboarding workflow skill</name>
  <files>skills/coco-onboarding/SKILL.md</files>
  <action>
Create `skills/coco-onboarding/SKILL.md` with the following structure:

**Frontmatter:**
```yaml
---
name: coco-onboarding
description: "Use when onboarding to a new or unfamiliar codebase. Guides you through understanding architecture, key modules, and code patterns step-by-step using CocoSearch."
---
```

**Content -- adaptive branching workflow (NOT rigid linear steps):**

The skill should read like a senior developer guiding someone through a codebase. Write in second person imperative, conversational tone. The skill should instruct Claude to auto-execute CocoSearch MCP tools at each step.

**Structure:**

1. **Pre-flight Check** (~15 lines)
   - Use `list_indexes()` to check if an index exists for the current project
   - Use `index_stats()` to check staleness (>7 days = suggest reindex)
   - If no index exists, offer to run `index_codebase(path)` first
   - If index exists but stale, mention it and ask if user wants to reindex

2. **Step 1: Architecture Overview (10,000ft view)** (~30 lines)
   - Search for entry points: `search_code("main entry point application startup", symbol_type="function")`
   - Search for project organization: `search_code("module initialization configuration setup")`
   - Synthesize findings: present the codebase structure (what are the main modules, what does each do)
   - Branch: If this is a web app, look for routes/handlers. If CLI, look for commands. If library, look for public API.

3. **Step 2: Drill into Key Layers** (~30 lines)
   - Based on Step 1 findings, drill into 2-3 key architectural layers:
     - API/Interface layer: `search_code("API endpoint handler route", symbol_type=["function", "class"])`
     - Business logic layer: `search_code("service business logic core", symbol_type="class")`
     - Data layer: `search_code("database model schema repository", symbol_type="class")`
   - For each layer: show concrete code examples from the codebase (use smart_context=True for full function bodies)
   - Adaptive: skip layers that don't exist (e.g., no database layer in a pure library)

4. **Step 3: Patterns and Conventions** (~20 lines)
   - Search for error handling patterns: `search_code("error handling exception")`
   - Search for testing patterns: `search_code("test setup fixture mock")`
   - Search for configuration patterns: `search_code("configuration settings environment")`
   - Present: "This codebase follows X pattern for error handling, Y approach for testing"

5. **Step 4: Optional Summary Document** (~15 lines)
   - Ask user: "Would you like me to generate a codebase summary document?"
   - If yes, create a markdown document with:
     - Architecture overview (from Step 1)
     - Key modules and their responsibilities
     - Important patterns and conventions
     - Date generated + index name (for freshness tracking)
     - Suggested filename: `CODEBASE_OVERVIEW.md` in project root

**Key design decisions:**
- At each step, PRESENT findings in a synthesized summary (not raw search results)
- After Step 1, ask "Want me to drill deeper into any specific area?" before proceeding to Step 2
- Use `use_hybrid_search=True` when searching for specific identifiers found in earlier steps
- Use `smart_context=True` (default) to show full function/class bodies
- Use `symbol_type` filtering to focus results (functions for entry points, classes for models)
- Tone: conversational, like a senior dev walking through code. Not documentation-style.

**Installation section at bottom** (~10 lines):
- Claude Code: `cp skills/coco-onboarding/SKILL.md ~/.claude/skills/coco-onboarding/SKILL.md`
- OpenCode: `cp skills/coco-onboarding/SKILL.md ~/.config/opencode/skills/coco-onboarding/SKILL.md`
- Or project-local: copy to `.claude/skills/` or `.opencode/skills/` in project root
  </action>
  <verify>
File exists: `ls -la skills/coco-onboarding/SKILL.md`
Line count: `wc -l skills/coco-onboarding/SKILL.md` (should be 100-180 lines)
Contains MCP tool references: `grep -c "search_code\|list_indexes\|index_stats\|index_codebase" skills/coco-onboarding/SKILL.md` (should be >= 4)
Contains adaptive branching: `grep -c "If\|based on\|branch\|depending" skills/coco-onboarding/SKILL.md` (should be >= 3)
Contains installation instructions: `grep -c "claude/skills\|opencode/skills" skills/coco-onboarding/SKILL.md` (should be >= 2)
Has valid frontmatter: `head -5 skills/coco-onboarding/SKILL.md` shows YAML block
  </verify>
  <done>
Onboarding workflow skill exists at skills/coco-onboarding/SKILL.md with:
- Valid YAML frontmatter with "Use when..." description
- Pre-flight index check with staleness detection
- Adaptive architecture overview starting with entry points
- Drill-down into key architectural layers with code examples
- Pattern/convention discovery
- Optional summary document generation with freshness marker
- Installation instructions for Claude Code and OpenCode
- Conversational tone throughout
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate onboarding skill completeness</name>
  <files>skills/coco-onboarding/SKILL.md</files>
  <action>
Validate the created SKILL.md meets all phase requirements:

1. **Frontmatter validation:**
   - Has valid YAML frontmatter with `name` and `description`
   - Description starts with "Use when..." (triggering condition, not workflow summary)
   - Total frontmatter under 1024 characters

2. **Adaptive flow validation:**
   - Skill uses branching language ("If...", "Based on...", "Depending on...")
   - NOT rigid numbered steps that must be followed in order
   - Each step adapts based on what previous searches found

3. **Auto-execute validation:**
   - Skill instructs Claude to call CocoSearch tools directly (not asking user to run CLI commands)
   - References MCP tool names: search_code, list_indexes, index_stats, index_codebase
   - Includes specific query examples with parameters

4. **Content completeness:**
   - Pre-flight check for index existence and staleness
   - Architecture overview with entry point discovery
   - Layer drill-down with code examples
   - Pattern/convention discovery
   - Optional summary document with freshness marker (date + index name)

5. **Installation instructions:**
   - Claude Code path shown
   - OpenCode path shown

If any validation fails, update the file to fix issues.
  </action>
  <verify>
Description trigger: `sed -n '/^description:/p' skills/coco-onboarding/SKILL.md` starts with "Use when"
Tool references: `grep -c "search_code" skills/coco-onboarding/SKILL.md` >= 5
Staleness check: `grep -c "stale\|staleness\|days" skills/coco-onboarding/SKILL.md` >= 1
Summary doc: `grep -c "summary\|CODEBASE_OVERVIEW\|freshness" skills/coco-onboarding/SKILL.md` >= 1
  </verify>
  <done>
Onboarding skill passes all validation:
- Valid frontmatter with "Use when..." description
- Adaptive branching flow (not rigid linear)
- Auto-executes CocoSearch MCP tools at each step
- Complete coverage of all required sections
- Installation instructions for both platforms
  </done>
</task>

</tasks>

<verification>
1. File exists: `ls skills/coco-onboarding/SKILL.md`
2. Frontmatter valid: `head -5 skills/coco-onboarding/SKILL.md` shows YAML block
3. MCP tools referenced: `grep -c "search_code\|list_indexes\|index_stats\|index_codebase" skills/coco-onboarding/SKILL.md` >= 4
4. Adaptive flow: `grep -ci "if\|based on\|branch\|depending" skills/coco-onboarding/SKILL.md` >= 3
5. Installation: `grep -c "claude/skills\|opencode" skills/coco-onboarding/SKILL.md` >= 2
6. Summary doc freshness: `grep -c "freshness\|date\|stale" skills/coco-onboarding/SKILL.md` >= 1
</verification>

<success_criteria>
- Onboarding workflow skill exists at skills/coco-onboarding/SKILL.md
- Skill loads without YAML errors (valid frontmatter with "Use when..." description)
- Skill checks for index existence before starting (offers to index if missing)
- Skill starts with architecture overview (entry points, modules, organization)
- Skill drills into key layers with concrete code examples
- Skill discovers patterns and conventions
- Skill optionally generates summary document with date/index freshness marker
- Skill auto-executes CocoSearch searches (not manual CLI commands)
- Skill uses adaptive branching (not rigid linear steps)
- Skill feels like a senior developer walkthrough
</success_criteria>

<output>
After completion, create `.planning/phases/41-workflow-skills/41-01-SUMMARY.md`
</output>
