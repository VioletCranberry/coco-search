# Milestone v1.5: Configuration & Architecture Polish

**Status:** SHIPPED 2026-02-01
**Phases:** 19-22
**Total Plans:** 11

## Overview

Clean up configuration patterns, standardize environment variables, and refactor language chunking for extensibility. Focus on developer experience and architecture improvements.

## Phases

### Phase 19: Config Env Var Substitution
**Goal**: Config files support environment variable substitution for flexible deployment
**Depends on**: Nothing (first phase of v1.5)
**Requirements**: CONFIG-01, CONFIG-02, CONFIG-03
**Plans**: 2 plans

Plans:
- [x] 19-01-PLAN.md — TDD: Environment variable substitution function
- [x] 19-02-PLAN.md — Integration into config loader

**Success Criteria:**
1. User can write `${DATABASE_URL}` in config and it resolves to env var value
2. User sees clear error message when referenced env var is missing
3. User can use env var substitution in indexing, search, and embedding config sections

### Phase 20: Env Var Standardization
**Goal**: All CocoSearch environment variables use consistent COCOSEARCH_* naming
**Depends on**: Phase 19 (config substitution enables cleaner env var usage)
**Requirements**: ENV-01, ENV-02, ENV-03, ENV-04, ENV-05
**Plans**: 4 plans

Plans:
- [x] 20-01-PLAN.md — Core code env var migration + validation module
- [x] 20-02-PLAN.md — Integration test env var migration
- [x] 20-03-PLAN.md — CLI config check command
- [x] 20-04-PLAN.md — Documentation and CHANGELOG

**Success Criteria:**
1. User sees only COCOSEARCH_* prefixed env vars in .env.example
2. User can set COCOSEARCH_DATABASE_URL and app connects to database
3. User can set COCOSEARCH_OLLAMA_URL and app uses that Ollama instance
4. User finds COCOSEARCH_* naming in all documentation
5. docker-compose.yml uses COCOSEARCH_* vars consistently

### Phase 21: Language Chunking Refactor
**Goal**: Language handlers use registry pattern for clean extensibility
**Depends on**: Phase 20 (standalone refactor, ordered after env cleanup)
**Requirements**: LANG-01, LANG-02, LANG-03, LANG-04, LANG-05
**Plans**: 4 plans

Plans:
- [x] 21-01-PLAN.md — Handlers package foundation (Protocol, registry, text fallback)
- [x] 21-02-PLAN.md — Language handler modules (HCL, Dockerfile, Bash)
- [x] 21-03-PLAN.md — Flow integration and backward-compatible re-exports
- [x] 21-04-PLAN.md — Handler tests and extension documentation

**Success Criteria:**
1. User sees separate module files for HCL, Dockerfile, and Bash chunking
2. Developer adding new language creates single module file following documented interface
3. Registry autodiscovers available language handlers without manual registration
4. Existing chunking behavior unchanged (HCL, Dockerfile, Bash work as before)
5. Each language module exports consistent separator and metadata extractor

### Phase 22: Documentation Polish
**Goal**: README has professional navigation via table of contents
**Depends on**: Phase 21 (documentation reflects final state)
**Requirements**: DOCS-01, DOCS-02
**Plans**: 1 plan

Plans:
- [x] 22-01-PLAN.md — Restructure README with comprehensive TOC

**Success Criteria:**
1. User can click TOC entry in README and jump to that section
2. TOC covers all major README sections (installation, usage, configuration, etc.)

---

## Milestone Summary

**Key Decisions:**

- Env var substitution after YAML parse, before Pydantic validation
- ${VAR} and ${VAR:-default} syntax supported
- Standardized on COCOSEARCH_* prefix for all environment variables
- Protocol uses SEPARATOR_SPEC and extract_metadata() for CocoIndex integration
- Handlers export CustomLanguageSpec for CocoIndex chunking
- Extension registry uses fail-fast ValueError on conflicts at module import time
- EXTENSIONS use dot format ['.tf', '.hcl'] to match registry lookup expectations
- TOC emoji selection for visual distinction in README navigation

**Issues Resolved:**

- Inconsistent env var naming (COCOINDEX_DATABASE_URL vs OLLAMA_HOST)
- Language handlers tightly coupled in single file
- README lacked navigation structure for 600+ line document

**Issues Deferred:**

- Config inheritance (base + override files) — complexity vs value tradeoff
- Per-directory config overrides — reassess if demand emerges

**Technical Debt Incurred:**

- None — tech debt from audit (3 test updates) resolved via quick task 001

---

*For current project status, see .planning/STATE.md*
*Archived: 2026-02-01*
