# Requirements Archive: v1.3 Docker Integration Tests

**Archived:** 2026-01-30
**Status:** ✅ SHIPPED

This is the archived requirements specification for v1.3.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

# Requirements: CocoSearch v1.3

**Defined:** 2026-01-30
**Core Value:** Semantic code search that runs entirely locally — no data leaves your machine.

## v1.3 Requirements

Requirements for Docker Integration Tests & Infrastructure milestone.

### Container Infrastructure

- [x] **INFRA-01**: Integration tests use real Docker containers (not mocks)
- [x] **INFRA-02**: Containers start with health checks before tests execute
- [x] **INFRA-03**: Containers automatically cleaned up after test session
- [x] **INFRA-04**: Test isolation via database state cleanup between tests
- [x] **INFRA-05**: Session-scoped container fixtures for performance (reuse across tests)

### PostgreSQL Integration

- [x] **PG-01**: Integration tests connect to real PostgreSQL+pgvector container
- [x] **PG-02**: pgvector extension initialized automatically in test database
- [x] **PG-03**: Database schema created correctly in test container
- [x] **PG-04**: Database state cleaned between tests (truncate, not drop/recreate)
- [x] **PG-05**: Vector similarity search works correctly with real pgvector

### Ollama Integration

- [x] **OLLAMA-01**: Integration tests use real Ollama for embedding generation
- [x] **OLLAMA-02**: Warmup fixture mitigates 30s first-request timeout
- [x] **OLLAMA-03**: Embedding generation produces correct vector dimensions
- [x] **OLLAMA-04**: Optional dockerized Ollama (users can choose native or Docker)
- [x] **OLLAMA-05**: Tests detect native Ollama availability, fallback to Docker

### End-to-End Flows

- [x] **E2E-01**: Full indexing flow tested (files → chunks → embeddings → storage)
- [x] **E2E-02**: Full search flow tested (query → embedding → vector search → results)
- [x] **E2E-03**: CLI index command works end-to-end with real services
- [x] **E2E-04**: CLI search command works end-to-end with real services
- [x] **E2E-05**: Search results contain correct file paths and line numbers
- [x] **E2E-06**: DevOps files (Terraform, Dockerfile, Bash) indexed correctly

### CI/CD Integration (DEFERRED)

- [ ] **CI-01**: GitHub Actions workflow runs integration tests
- [ ] **CI-02**: CI uses Docker services for PostgreSQL and Ollama
- [ ] **CI-03**: Environment-based hostname detection (localhost vs container names)
- [ ] **CI-04**: Integration tests can be skipped locally via pytest marker

### Test Organization

- [x] **ORG-01**: Unit tests separated into tests/unit/ directory
- [x] **ORG-02**: Integration tests in tests/integration/ directory
- [x] **ORG-03**: pytest markers distinguish unit vs integration tests
- [x] **ORG-04**: Default test run executes unit tests only (fast)
- [x] **ORG-05**: Integration tests run via explicit marker or CI

## Future Requirements

Deferred to later milestones.

### Performance Optimization

- **PERF-01**: Parallel integration test execution with pytest-xdist
- **PERF-02**: Per-worker database isolation for parallel tests
- **PERF-03**: Test execution time benchmarking

### Extended Coverage

- **EXT-01**: MCP server tools tested end-to-end
- **EXT-02**: REPL commands tested end-to-end
- **EXT-03**: Multiple concurrent index operations tested

## Out of Scope

Explicitly excluded from this milestone.

| Feature | Reason |
|---------|--------|
| Kubernetes testing | Docker sufficient for local/CI integration tests |
| Remote Docker hosts | Local Docker only for v1.3 |
| Custom Ollama models | nomic-embed-text only; model flexibility is v2+ |
| Windows container support | Linux containers only; Windows adds complexity |
| Test coverage reporting | Focus on correctness first, metrics later |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| ORG-01 | Phase 11 | Complete |
| ORG-02 | Phase 11 | Complete |
| ORG-03 | Phase 11 | Complete |
| ORG-04 | Phase 11 | Complete |
| ORG-05 | Phase 11 | Complete |
| INFRA-01 | Phase 12 | Complete |
| INFRA-02 | Phase 12 | Complete |
| INFRA-03 | Phase 12 | Complete |
| INFRA-04 | Phase 12 | Complete |
| INFRA-05 | Phase 12 | Complete |
| PG-01 | Phase 12 | Complete |
| PG-02 | Phase 12 | Complete |
| PG-03 | Phase 12 | Complete |
| PG-04 | Phase 12 | Complete |
| PG-05 | Phase 12 | Complete |
| OLLAMA-01 | Phase 13 | Complete |
| OLLAMA-02 | Phase 13 | Complete |
| OLLAMA-03 | Phase 13 | Complete |
| OLLAMA-04 | Phase 13 | Complete |
| OLLAMA-05 | Phase 13 | Complete |
| E2E-01 | Phase 14 | Complete |
| E2E-02 | Phase 14 | Complete |
| E2E-03 | Phase 14 | Complete |
| E2E-04 | Phase 14 | Complete |
| E2E-05 | Phase 14 | Complete |
| E2E-06 | Phase 14 | Complete |
| CI-01 | - | Deferred |
| CI-02 | - | Deferred |
| CI-03 | - | Deferred |
| CI-04 | - | Deferred |

---

## Milestone Summary

**Shipped:** 26 of 30 v1.3 requirements
**Adjusted:** None
**Dropped:** CI-01 through CI-04 (CI/CD Integration) — deferred due to containerized Ollama API compatibility issues; native Ollama required in CI environments

---
*Archived: 2026-01-30 as part of v1.3 milestone completion*
