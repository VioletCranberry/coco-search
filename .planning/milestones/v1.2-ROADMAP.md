# Milestone v1.2: DevOps Language Support

**Status:** SHIPPED 2026-01-27
**Phases:** 08-10, 04-soi (mapped as Phases 1-4 in milestone)
**Total Plans:** 6

## Overview

CocoSearch v1.2 adds language-aware chunking and rich metadata extraction for HCL (Terraform), Dockerfile, and Bash/Shell files. The milestone extends the existing single-flow pipeline with zero new runtime dependencies, using CocoIndex's `custom_languages` API and Python stdlib `re`. Four phases follow a strict dependency chain: correct chunk boundaries enable metadata extraction, which feeds into the flow/schema, which populates data for search to surface.

## Phases

### Phase 1 (08): Custom Language Definitions and File Routing

**Goal**: DevOps files are chunked at structurally meaningful boundaries, not plain-text splits.
**Depends on**: None (foundation phase).
**Plans**: 2 plans

Plans:
- [x] 08-01-PLAN.md -- Language definitions (HCL, Dockerfile, Bash CustomLanguageSpecs) and DevOps file patterns
- [x] 08-02-PLAN.md -- Language routing (extract_language) and flow integration (custom_languages wiring)

**Requirements:** REQ-01 through REQ-06 (Chunking)

**Details:**
- Three CustomLanguageSpec definitions with standard Rust regex separators
- 8 DevOps file patterns in IndexingConfig
- extract_language function with Dockerfile filename-based routing
- custom_languages wired into SplitRecursively

---

### Phase 2 (09): Metadata Extraction

**Goal**: Every DevOps chunk carries structured metadata identifying what it is (block type, hierarchy, language).
**Depends on**: Phase 1 (chunk boundaries must be correct for metadata regex to match block starts).
**Plans**: 1 plan

Plans:
- [x] 09-01-PLAN.md -- DevOpsMetadata dataclass, per-language extractors (HCL, Dockerfile, Bash), dispatch function, and comprehensive tests

**Requirements:** REQ-07 through REQ-13 (Metadata)

**Details:**
- DevOpsMetadata dataclass with block_type, hierarchy, language_id fields
- 8 compiled regex patterns for comment stripping and block extraction
- Per-language extractors: HCL (12 block keywords), Dockerfile (FROM + instructions), Bash (3 function syntaxes)
- Dispatch map routing by language identifier

---

### Phase 3 (10): Flow Integration and Schema

**Goal**: The indexing pipeline produces DevOps-aware chunks with metadata stored in PostgreSQL, without breaking existing indexes.
**Depends on**: Phase 1 (language definitions) + Phase 2 (metadata extraction).
**Plans**: 1 plan

Plans:
- [x] 10-01-PLAN.md -- Wire metadata extraction into flow pipeline and add metadata fields to collector

**Requirements:** REQ-14 through REQ-17 (Flow/Schema)

**Details:**
- extract_devops_metadata transform wired after chunking in flow
- Three new collect() kwargs for PostgreSQL columns
- Bracket notation for struct sub-field access
- Primary keys unchanged (filename, location)

---

### Phase 4 (04-soi): Search and Output Integration

**Goal**: Users and calling LLMs see DevOps metadata in search results and can filter by DevOps language.
**Depends on**: Phase 3 (metadata must be populated in PostgreSQL before search can surface it).
**Plans**: 2 plans

Plans:
- [x] 04-01-PLAN.md -- Search query layer: extended SearchResult, metadata SQL, DevOps language filter, graceful degradation
- [x] 04-02-PLAN.md -- Output integration: JSON/pretty formatters with metadata annotations, MCP response with metadata fields

**Requirements:** REQ-18 through REQ-26 (Search/Output)

**Details:**
- Extended SearchResult with metadata fields
- DEVOPS_LANGUAGES and LANGUAGE_ALIASES for filtering
- Module-level graceful degradation for pre-v1.2 indexes
- JSON, pretty, and MCP output surfaces with metadata annotations
- Pygments lexer mapping for DevOps syntax highlighting

---

## Coverage

| Requirement | Phase | Category |
|-------------|-------|----------|
| REQ-01 | Phase 1 | Chunking |
| REQ-02 | Phase 1 | Chunking |
| REQ-03 | Phase 1 | Chunking |
| REQ-04 | Phase 1 | Chunking |
| REQ-05 | Phase 1 | Chunking |
| REQ-06 | Phase 1 | Chunking |
| REQ-07 | Phase 2 | Metadata |
| REQ-08 | Phase 2 | Metadata |
| REQ-09 | Phase 2 | Metadata |
| REQ-10 | Phase 2 | Metadata |
| REQ-11 | Phase 2 | Metadata |
| REQ-12 | Phase 2 | Metadata |
| REQ-13 | Phase 2 | Metadata |
| REQ-14 | Phase 3 | Flow/Schema |
| REQ-15 | Phase 3 | Flow/Schema |
| REQ-16 | Phase 3 | Flow/Schema |
| REQ-17 | Phase 3 | Flow/Schema |
| REQ-18 | Phase 4 | Search/Output |
| REQ-19 | Phase 4 | Search/Output |
| REQ-20 | Phase 4 | Search/Output |
| REQ-21 | Phase 4 | Search/Output |
| REQ-22 | Phase 4 | Search/Output |
| REQ-23 | Phase 4 | Search/Output |
| REQ-24 | Phase 4 | Search/Output |
| REQ-25 | Phase 4 | Search/Output |
| REQ-26 | Phase 4 | Search/Output |

**Mapped:** 26/26 -- no orphaned requirements.

## Milestone Summary

**Key Decisions:**
- Zero new dependencies (CocoIndex custom_languages + Python stdlib re)
- Single flow architecture (not separate DevOps flow)
- Regex-only approach (no external parsers)
- Empty strings over NULLs for metadata
- Standard Rust regex only for separators (CocoIndex uses regex v1.12.2, NOT fancy-regex)
- Additive schema only (no primary key changes)
- Flat metadata fields in MCP response (not nested)
- Module-level graceful degradation flag for pre-v1.2 indexes

**Issues Resolved:**
- Rich bracket escaping for literal [lang] annotation display
- CocoIndex decorator test: behavioral check instead of __wrapped__ attribute
- MCP test mock results updated for v1.2 7-element row format

**Issues Deferred:**
- Dockerfile stage tracking for non-FROM instructions (requires two-pass processing)
- Block type search filter (--block-type) -- validate demand first
- Hierarchy search filter (--hierarchy) -- validate demand first
- Bare Dockerfile filename pattern support needs runtime validation

**Technical Debt Incurred:**
None -- zero TODO/FIXME/placeholder/stub patterns across all modified source files.

---

_For current project status, see .planning/MILESTONES.md_
