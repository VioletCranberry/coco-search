# Requirements Archive: v1.2 DevOps Language Support

**Archived:** 2026-01-27
**Status:** SHIPPED

This is the archived requirements specification for v1.2.
For current requirements, see `.planning/REQUIREMENTS.md` (created for next milestone).

---

## Scope Summary

Add language-aware chunking and rich metadata extraction for HCL (Terraform), Dockerfile, and Bash/Shell files using CocoIndex's `custom_languages` API. Zero new runtime dependencies. Works for pure infrastructure repos and mixed codebases.

## Requirements

### Chunking (Language-Aware)

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-01 | HCL block-level chunking via `CustomLanguageSpec` regex separators | Must | [x] Complete |
| REQ-02 | Dockerfile instruction-level chunking via `CustomLanguageSpec` regex separators | Must | [x] Complete |
| REQ-03 | Bash function-level chunking via `CustomLanguageSpec` regex separators | Must | [x] Complete |
| REQ-04 | File patterns added to `IndexingConfig.include_patterns` | Must | [x] Complete |
| REQ-05 | Correct language routing (extension/filename to language spec) | Must | [x] Complete |
| REQ-06 | Non-DevOps files unaffected by custom language additions | Must | [x] Complete |

### Metadata Extraction

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-07 | HCL block type extraction (resource, data, module, etc.) | Must | [x] Complete |
| REQ-08 | HCL resource hierarchy (e.g., `resource.aws_s3_bucket.data`) | Should | [x] Complete |
| REQ-09 | Dockerfile instruction type extraction (FROM, RUN, COPY, etc.) | Must | [x] Complete |
| REQ-10 | Dockerfile stage name for FROM instructions (e.g., `stage:builder`) | Should | [x] Complete |
| REQ-11 | Bash function name extraction (e.g., `function:deploy_app`) | Should | [x] Complete |
| REQ-12 | Metadata extraction as CocoIndex op function returning `DevOpsMetadata` dataclass | Must | [x] Complete |
| REQ-13 | Empty strings (not NULLs) for non-DevOps files and missing metadata | Must | [x] Complete |

### Flow and Schema Integration

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-14 | Pass `custom_languages` to `SplitRecursively` constructor in flow | Must | [x] Complete |
| REQ-15 | Add metadata extraction step after chunking in flow | Must | [x] Complete |
| REQ-16 | Three new TEXT columns in PostgreSQL chunks table | Must | [x] Complete |
| REQ-17 | Stable primary keys to prevent schema migration data loss | Must | [x] Complete |

### Search and Output Integration

| ID | Requirement | Priority | Status |
|----|------------|----------|--------|
| REQ-18 | Extended `SearchResult` with `block_type`, `hierarchy`, `language_id` fields | Must | [x] Complete |
| REQ-19 | SQL queries select new metadata columns | Must | [x] Complete |
| REQ-20 | New language filter values: `terraform`/`hcl`, `dockerfile`, `bash`/`shell` | Must | [x] Complete |
| REQ-21 | Dockerfile language filter via basename matching (no extension) | Must | [x] Complete |
| REQ-22 | Metadata displayed in JSON output | Must | [x] Complete |
| REQ-23 | Metadata displayed in pretty output | Must | [x] Complete |
| REQ-24 | MCP server includes metadata in `search_code` response | Must | [x] Complete |
| REQ-25 | Graceful degradation for pre-v1.2 indexes | Should | [x] Complete |
| REQ-26 | Syntax highlighting for HCL, Dockerfile, Bash in pretty output | Should | [x] Complete |

## Deferred to v1.3+

| ID | Feature | Reason |
|----|---------|--------|
| DEF-01 | Dockerfile stage tracking for non-FROM instructions | Requires two-pass file-level processing |
| DEF-02 | Block type search filter (`--block-type`) | Validate demand first |
| DEF-03 | Hierarchy search filter (`--hierarchy`) | Power user feature, validate demand first |
| DEF-04 | Terraform provider inference (aws_, azurerm_ prefix heuristic) | Nice but not essential |
| DEF-05 | Bash script purpose annotation (path-based heuristics) | Heuristic reliability uncertain |

## Traceability

| Requirement | Phase | Status |
|-------------|-------|--------|
| REQ-01 | Phase 1 | Complete |
| REQ-02 | Phase 1 | Complete |
| REQ-03 | Phase 1 | Complete |
| REQ-04 | Phase 1 | Complete |
| REQ-05 | Phase 1 | Complete |
| REQ-06 | Phase 1 | Complete |
| REQ-07 | Phase 2 | Complete |
| REQ-08 | Phase 2 | Complete |
| REQ-09 | Phase 2 | Complete |
| REQ-10 | Phase 2 | Complete |
| REQ-11 | Phase 2 | Complete |
| REQ-12 | Phase 2 | Complete |
| REQ-13 | Phase 2 | Complete |
| REQ-14 | Phase 3 | Complete |
| REQ-15 | Phase 3 | Complete |
| REQ-16 | Phase 3 | Complete |
| REQ-17 | Phase 3 | Complete |
| REQ-18 | Phase 4 | Complete |
| REQ-19 | Phase 4 | Complete |
| REQ-20 | Phase 4 | Complete |
| REQ-21 | Phase 4 | Complete |
| REQ-22 | Phase 4 | Complete |
| REQ-23 | Phase 4 | Complete |
| REQ-24 | Phase 4 | Complete |
| REQ-25 | Phase 4 | Complete |
| REQ-26 | Phase 4 | Complete |

---

## Milestone Summary

**Shipped:** 26 of 26 requirements
**Adjusted:** None -- all requirements implemented as scoped
**Dropped:** None

---
*Archived: 2026-01-27 as part of v1.2 milestone completion*
